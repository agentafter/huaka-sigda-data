name: Notificar a Herramientas Huaka al actualizar

on:
  push:
    branches: [main]
    paths:
      - '**/*.geojson'
      - '**/*'  # adjust to files that trigger updates

jobs:
  notify-kml-repo:
    runs-on: ubuntu-latest
    steps:
      - name: Send repository dispatch to agentafter/kml-extractor
        env:
          TARGET_REPO: agentafter/kml-extractor
        run: |
          event_type="sigda-updated"
          payload="{\"commit\":\"${GITHUB_SHA}\", \"ref\":\"${GITHUB_REF}\"}"
          curl -X POST \
            -H \"Accept: application/vnd.github.everest-preview+json\" \
            -H \"Authorization: token ${{ secrets.AGENTAFTER_PAT }}\" \
            https://api.github.com/repos/$TARGET_REPO/dispatches \
            -d "{\"event_type\":\"$event_type\",\"client_payload\":$payload}"
